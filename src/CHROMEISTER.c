/*********

File        CHROMEISTER.c
Author      EPW <estebanpw@uma.es>
Description Computes hits and generates a dotplot

USAGE       Usage is described by calling ./CHROMEISTER --help



**********/


#include <stdio.h>
#include <stdlib.h>
#include <math.h>
#include <string.h>
#include <ctype.h>
#include <pthread.h>
#include "structs.h"
#include "alignmentFunctions.h"
#include "commonFunctions.h"

#define MAX(x, y) (((x) > (y)) ? (x) : (y))
#define MIN(x, y) (((x) <= (y)) ? (x) : (y))
#define STARTING_SEQS 1000
#define PIECE_OF_DB_REALLOC 3200000 //half a gigabyte if divided by 8 bytes
#define RANGE 2

uint64_t custom_kmer = 32; // Defined as externals in structs.h
uint64_t hash_functions[3200] = {58509861, 126818362, 144600989, 146378489, 92010316,
47568662, 51001247, 46346627, 117175725, 68961764,
89988190, 27836753, 117452001, 17094876, 19413881,
54794297, 5721431, 11277339, 85008578, 21697015,
26159127, 67794593, 33353908, 100198502, 74725601,
142118040, 123130339, 74798483, 104698489, 148780580,
141469943, 11526804, 85220250, 94782744, 102954947,
44999889, 138552120, 23252133, 15656082, 25131425,
609394, 145037740, 115800168, 30838680, 52707211,
59550891, 33528513, 81231109, 124798883, 131430932,
53714859, 131074215, 118335012, 136761411, 124648259,
135493719, 57554256, 17956117, 81079031, 103964907,
61940679, 54251056, 29604861, 2583556, 111677716,
55277983, 65840024, 121322807, 24412781, 129732743,
46965514, 102237747, 114057716, 24900438, 71339265,
28012889, 73823588, 138564604, 83443664, 68480122,
61384097, 115093713, 146270804, 66223208, 136988275,
136141015, 73002003, 88631196, 142624064, 126141719,
41319992, 75050061, 40699108, 126487248, 70232823,
52337787, 68319510, 37496362, 123557893, 77595503,
124512053, 18188612, 7549065, 32599031, 11829640,
89552360, 109846495, 130876298, 119826594, 33147551,
80714238, 139832751, 110234971, 18855185, 20439550,
135067047, 80071310, 114836312, 26187202, 149010256,
35390056, 40347185, 22998122, 104116182, 30126477,
85519541, 149845086, 79430650, 88323554, 57873548,
28537593, 17735744, 106509460, 44358455, 7213105,
111672944, 43243092, 109544147, 92164250, 77886376,
1986250, 135484283, 116636377, 86387790, 37561457,
60053790, 69587550, 131630743, 20461978, 45434791,
64394799, 95570228, 296529, 19938404, 113305539,
67188292, 40096129, 16522418, 21237495, 61774821,
146749609, 46469650, 91337071, 31482890, 102486848,
101131110, 108129101, 119910068, 92831433, 60836761,
110947397, 103554430, 79529122, 75697774, 30662719,
20187910, 11421575, 90440672, 39515812, 92830227,
100649427, 77732236, 103926968, 36244225, 102891371,
127145687, 38780275, 129503429, 74894764, 82016831,
22175696, 92069490, 953291, 124983145, 5671269,
73053894, 85234959, 9115218, 136468730, 114877456,
25875919, 42892496, 120094157, 134565296, 75809586,
42231295, 26636962, 25776170, 45964401, 86842015,
33792416, 15575828, 121000467, 48010398, 6060852,
32356333, 79010844, 26740216, 57249907, 143474605,
101526856, 87375104, 104990631, 87791184, 57914757,
79673046, 16967970, 58494383, 127353580, 14156244,
48985964, 21452078, 14662914, 87667809, 40465529,
77609179, 91483136, 98173060, 76536216, 23237771,
62929357, 28065976, 93384558, 79338511, 81912211,
22672455, 74873611, 9410757, 126157666, 64380511,
31922242, 94057484, 114587205, 49252146, 7954525,
128123395, 22261869, 95125734, 6692387, 19382803,
78246178, 47468946, 10686737, 18199096, 15098623,
144978193, 29166638, 127955340, 62276311, 36908162,
55514679, 132069080, 5265545, 136075633, 18635779,
48514750, 88435077, 20730446, 18743080, 312908,
30853177, 9769265, 16965121, 54029969, 43821340,
29833664, 49678431, 34391328, 142781822, 85324734,
55442546, 35081198, 92492047, 60237727, 135818042,
97771442, 56938964, 65091116, 61700168, 145041206,
23536868, 143221037, 133162672, 2142586, 131441264,
106972294, 145027526, 56492075, 106287552, 83177108,
2757117, 105177355, 128673858, 51255204, 16976210,
82635320, 117589709, 52644529, 7068793, 91710549,
107741631, 25330822, 108269241, 19930440, 27923518,
94121781, 75547940, 38198886, 14918307, 137862915,
89272314, 126350787, 114103440, 33387329, 102095128,
75772234, 142401307, 36849074, 70799927, 113139425,
37126442, 86969393, 96444197, 70786400, 105021103,
107733902, 6582221, 119740098, 55122870, 138322312,
138654949, 107304723, 127513331, 30580604, 22130725,
29426254, 44125990, 134233545, 71895630, 118357096,
34493341, 37314477, 111940102, 30723252, 15514714,
81429653, 29376469, 112906756, 105859802, 94782537,
27494829, 82731115, 127604625, 73050565, 7791031,
3595072, 91337353, 123410167, 20744943, 134911901,
127327568, 143755097, 33180909, 123220438, 55834956,
88988296, 31437617, 62565899, 80850323, 26939198,
71633063, 89328474, 104267405, 103697718, 55061821,
81191730, 45621287, 57973815, 138489132, 2553212,
100117595, 22733673, 124288876, 44512831, 117432603,
71784323, 85856737, 103134257, 62007874, 21978158,
15152445, 14105082, 140464418, 91589665, 112954817,
95081550, 50226418, 87104462, 119914868, 78077097,
125428627, 39095778, 62905328, 95024336, 16232211,
62216201, 127726775, 106967004, 69051856, 50653118,
143566364, 103340327, 67533936, 98253685, 82422821,
9627741, 27515512, 85115834, 67323010, 104022860,
2502809, 91397272, 137163100, 132162845, 54060942,
68824768, 100402803, 50118563, 35902498, 33238043,
3192211, 67083395, 32608908, 96637256, 30702446,
35119799, 5567669, 107060931, 122890353, 129634210,
136232140, 79645520, 56975901, 50500208, 52947802,
63971072, 28927351, 131791860, 42983581, 112439441,
48585015, 23368687, 93955206, 12784609, 12184552,
30504450, 65061527, 143247560, 118510368, 42114752,
140769325, 107414092, 52253165, 34059501, 83243935,
64618899, 2670912, 49180696, 49583033, 26732135,
75710993, 60910815, 59182519, 106306590, 48907123,
25516069, 42406438, 147140524, 2754789, 115595912,
47387106, 121433242, 57332782, 37354746, 76293120,
139078192, 52042394, 12655328, 87838495, 83279879,
95284452, 8566476, 73258605, 59974714, 15081041,
67393343, 99981167, 21465793, 25008995, 136818193,
100491055, 120143207, 119663752, 25978095, 91691579,
101367216, 90890807, 142649457, 14697550, 33735040,
30790311, 67490294, 88694724, 136040566, 137733529,
100010990, 54719036, 126337841, 77394653, 3499999,
12897680, 22317885, 42921266, 36881515, 63808264,
7414907, 78838431, 118849552, 141636263, 112528102,
126415123, 72481676, 91419367, 56493974, 113932482,
131694319, 99855937, 113244791, 91970638, 148173324,
47682142, 114581013, 103407456, 87260660, 40845409,
96568608, 54378425, 114263870, 35986374, 73250387,
124793508, 102616654, 76235866, 38961731, 127210009,
10348730, 79079198, 89980381, 75642702, 100454974,
133682178, 50213099, 137741589, 15541458, 62743554,
23643013, 146580565, 84479113, 76085432, 74745674,
78202239, 111089087, 141262777, 1830524, 42677289,
147746882, 139854595, 129965631, 2980948, 148532393,
141131566, 54478319, 54733938, 100040298, 63775381,
75275062, 71621884, 112684689, 43996859, 96902014,
18581746, 112411312, 42393053, 49615742, 26513446,
101148259, 16716515, 124824347, 38494041, 141381601,
131842819, 102101568, 557254, 132963793, 45663235,
53685861, 40923340, 29730789, 127417298, 128446669,
15506696, 64889644, 137778458, 75735734, 5171110,
11584889, 122966278, 58561587, 118912347, 95967944,
91675239, 46764498, 65014596, 22744523, 1002748,
67118252, 36118689, 136959649, 13435254, 17420418,
90285583, 102988045, 30739798, 82712964, 122082822,
40375808, 38969484, 7950887, 14747155, 73937331,
127674518, 78647099, 37391185, 44913890, 30068005,
130372957, 121237704, 94765876, 104507656, 100790125,
140555191, 89772635, 121930343, 64888516, 142845945,
109491955, 77848476, 120788283, 66146897, 74349654,
33893018, 134095814, 1440670, 50358618, 5150302,
55427293, 98079691, 58758281, 135668525, 26178582,
35359837, 54794933, 126679151, 82160504, 24874533,
132299567, 75630031, 134737005, 104691502, 126729861,
139329723, 57536856, 55881914, 115003102, 95144758,
873002, 1348868, 30964268, 105419974, 92034014,
42602664, 101922136, 101348444, 141757726, 139796072,
55295219, 51702590, 83335890, 131328579, 80030369,
73826660, 133886765, 27312743, 61312779, 129063186,
43900746, 116859201, 38510892, 79186892, 23866238,
80799916, 33766686, 31183463, 50618878, 117002135,
26862537, 143174421, 49269035, 24718087, 40011109,
21192052, 491605, 42927755, 106214381, 16729706,
64165646, 97682399, 139284487, 78038227, 43558229,
39544348, 63825392, 82281153, 1952410, 38760159,
115773488, 60148197, 116200430, 78155316, 144075285,
74867640, 64804581, 147953296, 56811329, 10928685,
28559662, 134417218, 142895367, 114443606, 82523535,
118810929, 97050902, 120052296, 69064289, 111085769,
64433160, 87100885, 140063024, 135280956, 110280201,
38573799, 42394067, 147506059, 117018115, 24551049,
86678415, 50789699, 55368291, 54663670, 13816209,
79579803, 14886924, 17722254, 149420824, 123115306,
80911599, 47096921, 58660920, 6870525, 124560845,
119480279, 110036727, 75395187, 86483093, 109782399,
126533037, 64555874, 109825396, 34586916, 18975793,
43251630, 41031891, 33218429, 128499436, 133171174,
96881944, 116210202, 83548446, 94118199, 94371555,
21505373, 55764053, 25826192, 91704703, 69864727,
148641274, 46063855, 148181653, 128423171, 108942553,
24422422, 5753289, 6297592, 13570939, 15219032,
20651484, 49599734, 66708406, 20466227, 18474403,
108429060, 119252071, 72702584, 135386155, 6783304,
4355873, 100088842, 10948107, 3404284, 11787160,
98574068, 80886554, 16056922, 56044286, 118240106,
56631938, 39548459, 25675543, 105671484, 90098897,
89195649, 48012763, 102795519, 78101650, 36874309,
100130758, 70116031, 140720693, 96292798, 138563920,
89368428, 98803657, 73107230, 6982384, 42551557,
17530961, 94312702, 93330132, 60800828, 102232525,
57632826, 36090042, 66145717, 115721383, 71157724,
36628554, 145551404, 118449368, 117735527, 29738326,
143781037, 126383905, 18233504, 78337774, 121028502,
144926716, 25983976, 20001612, 105975449, 117607697,
91939802, 137086197, 65375630, 105535408, 74042444,
111169338, 87259825, 43435483, 54739345, 141476085,
16554568, 147135472, 102133626, 83948462, 105029323,
27393425, 21742075, 7158842, 149321407, 20972402,
85052516, 68779123, 25787536, 20474408, 77649113,
8778871, 139784382, 58790517, 142533557, 58545551,
51685229, 3100757, 40151369, 108908178, 87139841,
56994713, 67811043, 18226879, 86245228, 115039892,
148806262, 148475580, 67747494, 124033920, 19225243,
110965973, 91604318, 51928501, 53373134, 41966447,
102337084, 127018042, 119835839, 89570407, 143686816,
9106685, 149450304, 20552469, 10203181, 72799642,
27470964, 41210475, 107506255, 104587079, 42846645,
62228310, 16947245, 104856230, 42708312, 46807151,
65470013, 62028222, 122125392, 12277377, 56196413,
81076420, 13953247, 1981460, 4437627, 25586645,
1625371, 120531566, 6516118, 108468808, 120483584,
104499401, 103788565, 40301053, 75692317, 28582646,
90524620, 65570523, 83895088, 73543034, 29106283,
39537577, 77949520, 1949949, 85828151, 57989844,
18313203, 146994797, 36622355, 65538986, 105415311,
56675487, 45063782, 19155821, 70510452, 94325469,
68026867, 108862212, 3216579, 56063807, 83921521,
142136911, 122173886, 60135125, 103924571, 59775995,
76232494, 95077094, 112436912, 45844801, 5284106,
3045642, 30287632, 13019847, 137254749, 101452487,
1015893, 77190595, 75298932, 13870615, 89923062,
84487576, 5479285, 121242159, 48837826, 55216986,
106282748, 124342923, 131423343, 121730857, 57080771,
8962489, 17862885, 29494856, 73190945, 79976293,
32483762, 81971650, 104594575, 68943747, 84174298,
42395039, 129153997, 147338446, 81189019, 127962108,
42181174, 86798479, 52733138, 498785, 136703750,
71128462, 117076589, 136652254, 69411532, 50704657,
42740297, 78458056, 88471922, 2981662, 74607962,
128378979, 136144228, 149508433, 69360222, 129673441,
149243257, 36191200, 82606064, 95258880, 60508688,
44797860, 14624721, 125884838, 112635272, 35796053,
61802096, 103679448, 63607687, 126810584, 93104378,
136526122, 115777969, 85097547, 8904784, 3618030,
105148005, 100722755, 141029126, 103321709, 39775840,
141631591, 61551109, 143330122, 7340340, 118382612,
147148818, 59786760, 59438324, 47536521, 41280511,
132789743, 124137005, 119931900, 118901637, 108806396,
33339176, 49536507, 30914222, 120694921, 1680105,
123490210, 120660575, 91681173, 133605600, 110288932,
96731217, 144283865, 55825904, 2368543, 140932523,
113574222, 14259989, 123443389, 119442846, 67135071,
75415853, 78358553, 30075175, 149751233, 114277758,
141183497, 7293950, 139918412, 138061124, 18501705,
71609299, 14012958, 70542954, 79755718, 45155173,
111303909, 21276662, 44174764, 108720585, 123072681,
138986929, 111918612, 38239455, 144294080, 114485818,
15992861, 86852979, 91692674, 28085991, 67300530,
142889139, 35768778, 71883765, 67886598, 30821140,
73721284, 25999112, 95842793, 10121739, 62654061,
71776662, 52290078, 132053164, 3934020, 115146774,
132020506, 119826963, 56068842, 130986542, 12043048,
55707526, 121669518, 111493624, 75728393, 29433224,
35872389, 7695379, 145477458, 46211516, 82701694,
122031247, 119350424, 139524251, 61659585, 15189187,
6688446, 25028891, 901991, 44566398, 30006520,
46646864, 88163243, 104587782, 33244891, 33679871,
104564282, 122445746, 144352954, 103582865, 123650742,
94206145, 89490303, 29690855, 131454142, 56021026,
134759438, 6844198, 107653579, 86994493, 31004871,
39618107, 93435793, 135584513, 63256209, 73935542,
51438968, 127259086, 87613745, 134729657, 98984656,
86128945, 11660856, 100712109, 113838157, 99522113,
72053148, 127430731, 11996142, 58865647, 5791917,
58508577, 67219634, 5085121, 91311332, 48526394,
11886264, 20908693, 38325255, 24599284, 3864062,
70838067, 114784795, 111077223, 87417793, 47527549,
84597051, 9491172, 93978576, 87106365, 5894017,
55018678, 89976249, 27506188, 7522458, 37367427,
105522871, 107689238, 30849278, 70381582, 114466242,
6234345, 82952943, 3631984, 139283085, 13453415,
115575176, 103179938, 45352229, 119861136, 104801030,
78240409, 78916661, 8986960, 91321188, 7088778,
6476032, 121362183, 116291772, 93136576, 136050093,
88150346, 58770222, 104946965, 24259936, 97113509,
102881324, 48798147, 52244522, 148217672, 88355194,
19877781, 100736718, 13544782, 66822251, 94275577,
85796011, 59449746, 112285293, 37263339, 119896831,
141158542, 140974014, 76638637, 89645684, 145198052,
20886250, 57861932, 15293713, 77094025, 116995172,
86831791, 145341989, 94011788, 96620733, 58271207,
69286795, 132432180, 111840807, 8033333, 41115899,
32116328, 107847572, 133409691, 106328479, 79822286,
66966050, 146550583, 32837151, 143472826, 22565959,
126581933, 118695877, 143291494, 388246, 75858401,
32292265, 29568308, 46334589, 49581483, 109653561,
124252168, 96394751, 91383551, 123687054, 149947576,
26646129, 79487494, 139670546, 113338665, 95419692,
53556786, 122346812, 28354470, 41763391, 33916623,
30677637, 85606346, 107403972, 125252285, 122917396,
77245972, 100203285, 86146951, 109788836, 21113525,
69090350, 96592486, 64793316, 104634, 59908059,
62856997, 125579183, 30321118, 102558477, 104637447,
113242432, 116298624, 54595851, 124823870, 100615680,
76260278, 105396965, 89341015, 31967137, 82926781,
1482320, 20400863, 149269003, 149322309, 37603363,
84621683, 6255898, 49689889, 14867475, 56638683,
43499039, 68701869, 115763070, 95993301, 141404135,
44301827, 105052432, 146394840, 74969540, 140471924,
38634075, 29164814, 117542980, 74611910, 108822999,
120119727, 10715080, 9814950, 109175075, 19693674,
44560810, 29387895, 35939064, 61171235, 124545527,
134705931, 82130267, 147179783, 115394224, 138320228,
127541297, 126257637, 23066006, 25353806, 79267967,
148573220, 75471922, 126757740, 114424088, 81050450,
117382314, 41817913, 148338917, 7681723, 75919943,
116676735, 108965942, 87159419, 32420354, 66839556,
41799975, 142258747, 72385510, 79692384, 111321554,
140815168, 127037734, 64302508, 76748197, 45946204,
142498433, 34363477, 24689124, 24446552, 59979273,
27890962, 115821598, 108158427, 98452898, 46130611,
41005583, 29441203, 106650117, 1465292, 116755152,
29572061, 19227920, 30939885, 79620397, 93222039,
127666218, 134843268, 138970652, 64816087, 148009160,
43314735, 35516206, 37064339, 11347541, 44688229,
3436912, 76702729, 93300471, 40181727, 3271491,
20596780, 122170827, 73755584, 115560986, 17008930,
87345504, 145994661, 32766952, 99517297, 9440025,
127587595, 120941795, 101340312, 94385017, 149367495,
119926733, 66491898, 10237743, 42513743, 2277051,
63390435, 76161473, 122912015, 129659540, 66462362,
99311707, 59327570, 71357645, 93434535, 106521724,
109837431, 14437543, 7407385, 69821777, 93570926,
145740622, 93222940, 110925070, 54203249, 53375638,
54687705, 99136681, 40247072, 77364091, 51518169,
141010333, 33380954, 147409367, 79450538, 95024182,
73893758, 19828443, 88679929, 112750634, 78144995,
16522357, 141567082, 113124230, 122427676, 131570905,
17067376, 60866186, 56274291, 141326763, 58752939,
135252076, 124477619, 80071308, 82091559, 14994795,
30282861, 77674000, 100218206, 142672213, 7772245,
122617891, 123421969, 26926760, 76558075, 125464699,
84393685, 11202467, 71426761, 64572274, 227926,
107073581, 47670027, 146764362, 151332, 63366085,
129881110, 88462951, 106810696, 125185760, 74347784,
131412870, 108339543, 90198941, 16247708, 119275841,
148089877, 64322100, 94551106, 69884922, 118144964,
144200291, 7552899, 146951880, 90008782, 105855001,
12279961, 129948286, 66065287, 102306529, 10597730,
37614337, 113239006, 96152000, 145666352, 105831275,
35075346, 76296301, 53783069, 136549317, 52847051,
105995671, 45833742, 100321368, 19983878, 131795476,
142542082, 123236741, 145557096, 29701454, 109769230,
100427839, 149358509, 101176145, 134798920, 14714536,
97355239, 37941693, 11071344, 117979203, 78043790,
124494157, 148452440, 147175810, 18278504, 31405308,
6518772, 67490893, 68924527, 5470468, 90495237,
83385517, 149437704, 145175697, 85750684, 134945357,
9187778, 9605407, 101770921, 43884314, 112583837,
10425414, 132962587, 52161687, 118437972, 122063539,
27968036, 109713134, 37784087, 129054980, 99952518,
63623626, 82141236, 100249615, 120773626, 146006543,
84789118, 2111897, 105445912, 130145162, 71988820,
18072939, 123628784, 19601793, 2875518, 93264632,
112866501, 2078509, 67486975, 131527112, 70336910,
87900308, 72247204, 43641006, 106159030, 49222088,
142327333, 115461646, 26029496, 143551432, 114145826,
123553066, 118324685, 59580143, 111435027, 10207863,
60280112, 53416480, 97443923, 25514335, 146140152,
64506631, 62027121, 102475284, 90346807, 38291046,
38717303, 40315644, 136069920, 5920309, 53326969,
53640842, 7035006, 66529357, 18051832, 97548635,
5525354, 3284426, 149892167, 132463821, 17537006,
139365739, 144248646, 117491683, 43392821, 145447230,
41880824, 141991810, 115966867, 39529453, 84882749,
99039108, 37897800, 20636716, 57590758, 89151665,
123002025, 132262238, 106656577, 134399873, 86673326,
23435160, 69786617, 54603463, 65360494, 69454980,
95620811, 116531305, 39644209, 96790728, 117676889,
119595416, 72521866, 136075168, 1866745, 54970986,
125086143, 109530375, 46082524, 1548620, 130385512,
105605330, 9550893, 7826452, 67060123, 142141955,
100944173, 58246550, 41273465, 135000291, 18420535,
26641788, 20322313, 149455280, 67228481, 87620187,
49786977, 145173239, 143495844, 137402885, 110277143,
141797992, 33960558, 103979372, 8896478, 140088445,
18369185, 48865666, 12069973, 23782885, 7921473,
50215872, 138249699, 10038439, 3809442, 98952936,
28139173, 65160848, 121024967, 3926016, 108734961,
12721889, 81284460, 53367937, 144987350, 126676697,
19865365, 63520244, 35478617, 123030065, 22832493,
55526776, 25223857, 146015775, 63955130, 69997735,
21798373, 70166630, 106993121, 16068079, 93468280,
142080677, 124828290, 14255387, 34289018, 124691352,
129317884, 138579595, 43018865, 115170604, 22615617,
133602180, 99657146, 102573818, 112343151, 119737595,
145114554, 4968078, 31506905, 23746888, 57041617,
77963131, 125538731, 39857670, 118716978, 93789962,
73699497, 26035105, 142295112, 14112532, 147613379,
55492269, 112529561, 15654461, 13275901, 70728023,
68619875, 144320153, 96027021, 12104848, 56564327,
15794610, 123567984, 8028957, 2532986, 16219277,
85178683, 39181545, 42611446, 35145894, 6762686,
33639952, 72076901, 88400869, 27611677, 122463078,
5895473, 121711588, 80251251, 121871487, 15010206,
63205809, 143348562, 103218046, 32783083, 30386708,
139525100, 65377216, 140943213, 123971519, 69777781,
10516916, 5657616, 87702683, 25272784, 70887472,
50278714, 58449016, 115238555, 35758268, 118610225,
143436678, 12070135, 104181250, 102280420, 25999993,
273375, 26568916, 94137776, 37784492, 61838947,
130475872, 51484315, 97364009, 98613443, 28054361,
46251277, 46754730, 114006045, 61569096, 2382856,
111833583, 34423147, 3116132, 111602329, 83581946,
62553766, 88499855, 92447782, 7501234, 1369186,
69812263, 9677823, 55194122, 71908961, 96979536,
30329151, 24951086, 47049163, 76403324, 143635487,
25513392, 1338601, 136331733, 9393128, 28214555,
31838288, 115431184, 71431369, 5150786, 143369721,
93658591, 63480472, 12013934, 114351198, 45989446,
58684952, 60055448, 133552397, 134105783, 71595251,
130662525, 128468435, 44460035, 109498656, 95099419,
41500177, 43611117, 130512779, 31809634, 78043182,
92622258, 55359547, 67956646, 124292025, 44288339,
122056940, 141632279, 7016883, 33423959, 16103679,
13574246, 39963622, 126925210, 97428042, 105662865,
104918557, 126882322, 138556282, 118172053, 7760461,
113351198, 6624217, 38106487, 49377559, 65978436,
14198362, 91752557, 38310255, 144384143, 94609817,
112823072, 110243204, 148510024, 102215479, 79682789,
73370563, 66776991, 55178553, 31793529, 66416952,
149698791, 30388364, 64780657, 70300491, 96245773,
29433083, 104871881, 5395759, 119973135, 104893179,
98027883, 82721746, 132913425, 75810698, 81049255,
30456520, 139922547, 125337716, 63172468, 98126802,
32141038, 74486536, 33612853, 67797451, 138681960,
97887945, 106414295, 15840165, 94404319, 73043054,
31377729, 4449877, 36713780, 106773871, 144545323,
61853535, 97340113, 112235611, 131492933, 27870240,
27266742, 107831852, 48412322, 77079777, 22068510,
128952452, 30496310, 38198521, 130139199, 67675907,
119817625, 134945543, 135024973, 74576304, 34034429,
5420186, 72259677, 147987610, 53196878, 89466337,
111993611, 66292205, 128373411, 70529385, 145036580,
10521948, 63806811, 18621928, 33446476, 141664643,
72885377, 8670194, 142723044, 21800301, 82549104,
55733682, 67754739, 4003108, 27519411, 10944153,
1091262, 18410754, 114224432, 41749905, 64614397,
36228567, 11998650, 21474165, 56799555, 55290086,
115227500, 18646656, 113966002, 102079350, 53627548,
45157244, 49071465, 96525656, 146552108, 143449283,
25723025, 92813827, 138887249, 97775482, 52814664,
47637085, 27887005, 145899627, 101352798, 84796160,
230103, 59852204, 92267345, 99478153, 138859120,
41404746, 26304388, 33733212, 17009225, 128425731,
24031923, 142579136, 115606825, 30119691, 16551258,
38710478, 395278, 24631874, 61365389, 69519022,
65503768, 120919989, 86288857, 92543915, 51099737,
137953645, 51401292, 47036999, 23160583, 7150470,
104685447, 110018339, 40935926, 400458, 101256791,
108449298, 143308708, 11442429, 54994040, 4750632,
56456624, 61244167, 128362303, 107777783, 81335375,
85389010, 96402230, 52688031, 18890307, 58723456,
33309445, 144418860, 78152046, 695624, 101620643,
13035466, 10708546, 50918716, 1788441, 73905106,
75299799, 64023139, 87063733, 124715308, 75266096,
105656482, 68494245, 51875781, 13821655, 63807970,
72805300, 104067255, 135676661, 135215381, 67617943,
48440341, 10057302, 53120099, 4991360, 86692948,
136548712, 130967713, 27567315, 92569966, 107107604,
25434536, 100978150, 139611699, 25590329, 60683448,
106707210, 45672134, 15021210, 12406766, 131202584,
106434602, 107874119, 62267493, 30059151, 11982663,
56116543, 46138941, 8963078, 54312459, 51336238,
148344284, 46856524, 82400537, 19637661, 104467938,
78892779, 110623959, 113232783, 116663165, 53225655,
95349373, 44832607, 35216663, 45387859, 110233716,
103943198, 103090806, 106716189, 94893211, 68360676,
56716945, 112951082, 48794007, 17501789, 27326441,
15675515, 14545844, 36439561, 103430010, 49411711,
132565894, 64882608, 134115937, 13668501, 58173418,
74045502, 78799109, 2246781, 126667058, 91728662,
128542697, 70184462, 73983327, 33352964, 116704422,
22259403, 33601404, 65025971, 131818635, 141554742,
133782668, 26883048, 3934232, 51114548, 94797492,
8720812, 46594339, 88538844, 141358165, 107690714,
35921957, 98290001, 96225260, 96851249, 148062656,
30441366, 144147552, 92648948, 1054825, 135410324,
112236258, 39435031, 24244788, 121507715, 6692027,
36117631, 136925672, 106195257, 139934700, 16985260,
135887727, 41155291, 26033628, 30454475, 112817157,
45967849, 131865998, 34694716, 90663009, 78899518,
26367082, 56823651, 11416844, 127647731, 19124662,
140167804, 34462973, 88060359, 91381634, 15781483,
7915347, 73548730, 5890417, 79890758, 23138625,
68654280, 134158166, 117725844, 31567569, 26445474,
57894547, 87335262, 48998052, 37651905, 54777967,
50918990, 87669177, 71240472, 50102803, 83395653,
89032180, 11210662, 3482471, 15746471, 91011847,
69741860, 108108701, 130429172, 120999270, 141367870,
47907999, 5541418, 84380321, 68661115, 13237440,
103396766, 106709828, 67761511, 3630972, 105707523,
133500634, 14749608, 140261189, 131431823, 983487,
46037621, 51987546, 110273158, 127686402, 32064225,
32727090, 54743934, 2467131, 129095517, 134139936,
132522736, 55796872, 114281176, 7090697, 31403831,
140815495, 108250274, 62882525, 15503196, 49795676,
137569188, 31518706, 2274940, 33687202, 109060078,
100136026, 140834822, 62916573, 52259144, 32899461,
8553840, 120038711, 78954400, 75340229, 72865169,
36237452, 55059127, 106411274, 34081319, 120843432,
141901194, 20103915, 45846298, 58526181, 66217686,
124250178, 147825051, 12735351, 75718510, 112255948,
50001851, 72473327, 115562875, 102808242, 144005350,
144054584, 33279097, 14561236, 104991938, 34688588,
144361970, 39622908, 67561111, 86969271, 112245381,
110791660, 22700341, 125589187, 108532519, 22817918,
43154693, 98523672, 53055752, 11756391, 34933984,
126127785, 91428603, 60080781, 33187213, 140256985,
136852904, 138974675, 91241081, 108162291, 49500291,
74190923, 102359662, 147401210, 126299934, 149836093,
39264599, 82117763, 102080888, 57264025, 128423860,
81990379, 78709762, 57252636, 52530970, 20966684,
36557242, 88285859, 78514275, 82753203, 51150047,
136506156, 135788202, 66066348, 80616562, 76072945,
80650500, 60181642, 88761942, 24391343, 20401176,
20353113, 19561343, 234191, 87330633, 117437027,
121503423, 143060067, 138547941, 20086269, 140894704,
60536144, 138771013, 75305192, 9336344, 49676738,
38717481, 22972470, 96877087, 87939962, 145523889,
23326750, 141303053, 73280207, 108854449, 16525156,
30789728, 108588900, 106013836, 41556815, 117466535,
137862061, 1403295, 28315886, 136678131, 17090338,
23519139, 146694569, 112102695, 98257889, 2474585,
60636271, 40656435, 118015056, 66782606, 107360590,
34685817, 131682619, 146303357, 46455814, 93559435,
79686775, 13556479, 108449512, 18539917, 71846993,
21300037, 38373642, 100296797, 112173088, 42626363,
27106833, 67872046, 66191698, 75378680, 56519517,
106648045, 40624248, 131649570, 74052209, 127807956,
36477643, 19579680, 28015405, 11977667, 61142200,
112739180, 136048572, 42654303, 20280350, 106294029,
23399843, 21337273, 16280336, 69061058, 25571425,
47313419, 28671118, 145790817, 48221326, 22329046,
49458020, 83754627, 15129990, 36324743, 129133647,
7571402, 6751751, 105469767, 38718681, 94597883,
145174367, 114762477, 131064817, 82675483, 117154748,
5483680, 48442091, 27808664, 40390215, 82418987,
22372612, 73569854, 19251251, 99503592, 126567744,
100993230, 9054560, 14157772, 26748020, 135679121,
131433615, 134020254, 89026744, 8840739, 80311935,
1305949, 146841241, 138265112, 10098783, 130723617,
122475291, 136285669, 45667569, 118631697, 40800235,
43265537, 129938715, 52574703, 68897144, 75133856,
30443841, 90911777, 122820428, 86013779, 49752176,
49952430, 62410919, 71386932, 949192, 78921926,
18819263, 93076499, 100396226, 124926692, 77470590,
93470380, 25262032, 27521421, 107921027, 111280928,
4321122, 91635477, 91633132, 16823610, 81927252,
64620975, 122042369, 51966594, 131959145, 129678926,
113060878, 102305432, 53513691, 5077697, 119013516,
22837499, 11919583, 5530692, 86474616, 14421630,
22761382, 137699333, 100545195, 35413354, 134046998,
113692036, 3427758, 144846379, 61783537, 92695251,
127596755, 135779752, 40309585, 88616689, 7190680,
140612289, 67881606, 44586608, 88442244, 29264229,
149155237, 24960885, 135323235, 90974246, 22674743,
34775237, 136352965, 72131248, 17522629, 5164456,
128276267, 75785896, 107390132, 45363756, 125521836,
94732379, 35718252, 42260991, 50670850, 63922408,
138845003, 81714813, 112079261, 34536347, 90199224,
65574374, 31563060, 86916513, 25053753, 65453509,
36892906, 91617048, 138963785, 140066655, 137591069,
46783457, 88555936, 27261056, 139041535, 65418518,
108000783, 128586090, 65110729, 13619285, 24714310,
131709450, 23898137, 62600251, 129407028, 55934690,
23977443, 30614849, 87979932, 14002385, 99435815,
114195685, 46349903, 56761697, 135431203, 6343343,
5782638, 137162539, 94813298, 94446601, 2383478,
52457582, 69229923, 88617196, 85215778, 35057364,
33641917, 104125897, 41400875, 149830297, 35048908,
38635851, 107453818, 132940210, 3071135, 118441840,
36711476, 143419270, 84378129, 34527025, 139144687,
129767278, 72899041, 108755644, 74612674, 102799167,
116505403, 6285970, 2491786, 131260559, 113171491,
3197233, 27906948, 107710668, 123368690, 6246702,
1101804, 80237781, 61177712, 117160174, 76771150,
63408856, 77828562, 14989786, 148478786, 71968289,
91723873, 37794547, 16708730, 131217637, 67960475,
81347271, 61895288, 4718427, 21557983, 89918141,
92242997, 79906913, 62254115, 34080694, 112996494,
20835096, 2878106, 48651498, 3987136, 57408151,
21340532, 76013529, 72747187, 138848169, 110359995,
119507395, 137747084, 102420206, 97286807, 145632061,
51329722, 72864424, 98092428, 30614947, 23531963,
64944257, 5457384, 110910894, 140000583, 49374767,
126137473, 137768548, 49399948, 126825367, 24822196,
88616470, 72601934, 7151120, 34082989, 59876433,
14268130, 145883251, 89196532, 135307647, 20176244,
137811077, 82220673, 18056330, 132730546, 54647346,
93059084, 110526935, 45964838, 97944524, 28315898,
2226571, 75785570, 126127858, 112876473, 51452158,
36727396, 121343020, 71973509, 133148726, 83923049,
24074686, 144035859, 15598680, 106664392, 8073255,
109732880, 142535222, 41469427, 62661373, 28863594,
131849249, 69950130, 83680745, 82623231, 86919753,
125523826, 60489506, 146120475, 60626769, 69159449,
45510684, 58499336, 61207585, 116396924, 14761951,
106078356, 113311135, 16058523, 70865692, 95605249,
98924854, 93092690, 55104670, 78322970, 114168532,
4577134, 61484591, 15897177, 78784160, 68221255,
94228131, 18961747, 110995904, 143546306, 145680668,
37714462, 14805703, 73874275, 107795886, 30185797,
3204750, 122162870, 79871329, 50995014, 105327673,
22950009, 126759259, 78144601, 73977347, 126218469,
58723287, 144626361, 76676065, 50902162, 61270182,
31415341, 62262835, 11007519, 21438372, 37821044,
20689183, 60603732, 118583088, 133940388, 88375085,
60856227, 18204007, 25398304, 125637739, 129254650,
43258204, 130924439, 39194922, 43919056, 112559820,
33343708, 105795861, 31776999, 22356661, 106490599,
1434554, 56461798, 148379414, 120727045, 83087892,
73122716, 1979677, 15665229, 85293417, 124806054,
45484321, 47537591, 13837068, 10135699, 138971420,
32289826, 86335649, 58821745, 64022723, 45330382,
128003378, 64930449, 43085414, 40515870, 962551,
37620416, 94609870, 59153139, 124688174, 79190733,
54273782, 14215633, 85129183, 130505491, 73619944,
118790627, 95921961, 122455945, 1119200, 13424222,
27611662, 73827763, 90032621, 46271764, 72143851,
9421582, 145318358, 83821743, 109204798, 15411850,
147088829, 148208190, 96648376, 86751778, 81250673,
95098347, 51560360, 47465004, 56700025, 85942029,
107747695, 44802139, 47359612, 72267218, 4491774,
148250180, 129035190, 32007711, 59671140, 143967224,
71126184, 83273698, 18345021, 8400126, 8655515,
32677830, 95783760, 124676466, 65679024, 108610692,
23394978, 34134601, 5700989, 149088021, 65262488,
127599467, 133859689, 71924460, 146983800, 56502899,
136535926, 122575124, 139607293, 55473922, 94130741,
119293746, 131183305, 33338186, 42394745, 118460618,
15188927, 47353649, 31372320, 21471571, 146627349,
121115787, 138358983, 59113501, 71283083, 57160521,
85421180, 127872744, 53813635, 122223239, 69655196,
2516746, 119789376, 91508756, 95138427, 77046027,
72332291, 144948347, 96988839, 8005517, 15943695,
126467046, 78581236, 17903086, 74463747, 19641094,
85742738, 47973345, 102830375, 49312858, 68354633,
67158769, 19165625, 56897472, 78375698, 113646620,
6875856, 80711596, 106338640, 37357154, 14290443,
104244393, 42451366, 120329891, 70982619, 81545704,
41778146, 8700037, 47860160, 68856528, 75655923,
49291736, 104333965, 123843689, 20136012, 91290818,
115666730, 13098838, 142461865, 140891770, 85934877,
95632552, 121890578, 71255878, 28268366, 136491470,
82285671, 50918958, 139954540, 24301974, 149242045,
43195083, 61757292, 105215026, 38412507, 109689280,
101293341, 27788573, 72429791, 149225957, 43851839,
135508699, 52864159, 58234834, 89178291, 42052097,
71526522, 102512616, 48450892, 85920622, 82034543,
144970365, 21785438, 35181902, 60276862, 117042414,
120026983, 115768467, 22918126, 8303561, 41105112,
74372019, 62872588, 97399700, 143863914, 141947960,
110708555, 117900340, 147126880, 91883238, 31728736};

void init_args(int argc, char ** av, FILE ** query, FILE ** database, FILE ** out_database, uint64_t * custom_kmer, uint64_t * dimension, uint64_t * max_differences);

int main(int argc, char ** av){
    

    //clock_t begin, end;

    uint64_t i, j;

    //query to read kmers from, database to find seeds
    FILE * query = NULL, * database = NULL, * out_database = NULL;
    uint64_t dimension = 1000; // Default 1000 * 1000
    uint64_t max_differences = 0; // Default max number of wrong hashes
    uint64_t n_hash_functions = 100;
    
    
    init_args(argc, av, &query, &database, &out_database, &custom_kmer, &dimension, &max_differences);


    unsigned char char_converter[91];
    char_converter[(unsigned char)'A'] = 0;
    char_converter[(unsigned char)'C'] = 1;
    char_converter[(unsigned char)'G'] = 2;
    char_converter[(unsigned char)'T'] = 3;

    
    //Variables to account for positions
    //Print info
    fprintf(stdout, "[INFO] Loading database\n");
    //Variables to read kmers
    char c = 'N'; //Char to read character
    //Current length of array and variables for the buffer
    uint64_t idx = 0, r = 0;
    
    //Vector to read in batches
    char * temp_seq_buffer = NULL;
    if ((temp_seq_buffer = calloc(READBUF, sizeof(char))) == NULL) {
        terror("Could not allocate memory for read buffer");
    }

    //Dimensional matrix
    uint64_t ** representation = (uint64_t **) calloc(dimension+1, sizeof(uint64_t *));
    if(representation == NULL) terror("Could not allocate representation");
    for(i=0; i<dimension+1; i++){
        representation[i] = (uint64_t *) calloc(dimension+1, sizeof(uint64_t));
        if(representation[i] == NULL) terror("Could not allocate second loop representation");
    }

    unsigned char curr_kmer[custom_kmer], reverse_kmer[custom_kmer];
    curr_kmer[0] = reverse_kmer[0] = '\0';
    uint64_t word_size = 0, word_size_rev = 0;

    //To hold all information related to database
    uint64_t current_len = 0;
    
    //To force reading from the buffer
    idx = READBUF + 1;

    //Store positions of kmers
    uint64_t n_pools_used = 0;
    uint64_t n_pools_used_kmer = 0;


    //Mempool_l * mp = (Mempool_l *) malloc(MAX_MEM_POOLS*sizeof(Mempool_l));
    //if(mp == NULL) terror("Could not allocate vectors for memory pools");
    Mempool_l mp[MAX_MEM_POOLS];
    init_mem_pool_llpos(&mp[n_pools_used]);

    // mempool for first level
    Mempool_l_kmer mp_kmer[MAX_MEM_POOLS];
    init_mem_pool_llpos_kmer(&mp_kmer[n_pools_used_kmer]);

    llpos * aux, * pointer;
    llpos_kmer * aux_kmer;

    //unsigned char aux_kmer[custom_kmer+1];
    
    //Vector to store query seq
    unsigned char * seq_vector_query = (unsigned char *) malloc(READBUF*sizeof(unsigned char));
    if(seq_vector_query == NULL) terror("Could not allocate memory for query vector");

    /*
    Container * ct = (Container *) calloc(1, sizeof(Container));
    if(ct == NULL) terror("Could not allocate container");
    */
    /*
    typedef struct linked_list_kmer{
        unsigned char kmer[32];
        linked_list_kmer * next;
    } llpos_kmer;

    typedef struct static_table{
        llpos_kmer * table;
    } Static_table;
    */

    // Get file length to know aproximate kmer number
    fseek(database, 0, SEEK_END);
    uint64_t m_prime = (uint64_t) ftell(database);
    rewind(database);
    //remove this 
    //m_prime = 3999971; // Closest prime to 4,000,000
    m_prime = 2000003; // CLosets prime to 2,000,000
    uint64_t used_entries = 0;

    // Create initial level hash table
    Static_table st;
    st.table = (llpos_kmer *) calloc(m_prime, sizeof(llpos_kmer));
    st.count = (uint64_t *) calloc(m_prime, sizeof(uint64_t));
    st.picked_hash = (uint64_t *) calloc(m_prime, sizeof(uint64_t));
    if(st.table == NULL || st.count == NULL || st.picked_hash == NULL) terror("Could not allocate first level table");

    

    //begin = clock();
    uint64_t c_hash;

    c = buffered_fgetc(temp_seq_buffer, &idx, &r, database);
    while((!feof(database) || (feof(database) && idx < r))){

        if(c == '>'){
            // data_database.n_seqs++;
            // data_database.start_pos[data_database.n_seqs++] = pos_in_database;
            
            // if(pos_in_database == READBUF*n_realloc_database){ 
            //     n_realloc_database++; data_database.sequences = (unsigned char *) realloc(data_database.sequences, READBUF*n_realloc_database*sizeof(unsigned char));
            //     if(data_database.sequences == NULL) terror("Could not reallocate temporary database");
            // }

            // if(data_database.n_seqs == INITSEQS*n_seqs_database_realloc){
            //     n_seqs_database_realloc++; data_database.start_pos =  (uint64_t *) realloc(data_database.start_pos, INITSEQS*n_seqs_database_realloc*sizeof(uint64_t));
            // }


            while(c != '\n') c = buffered_fgetc(temp_seq_buffer, &idx, &r, database);  //Skip ID
                

            while(c != '>' && (!feof(database) || (feof(database) && idx < r))){ //Until next id
                c = buffered_fgetc(temp_seq_buffer, &idx, &r, database);
                c = toupper(c);
                if(c == 'A' || c == 'C' || c == 'G' || c == 'T'){
                    curr_kmer[word_size] = (unsigned char) c;
                    if(word_size < custom_kmer) ++word_size;
                    ++current_len;
                    //data_database.sequencesterror("Fatal error");[pos_in_database++] = (unsigned char) c;
            
                    // if(pos_in_database == READBUF*n_realloc_database){ 
                    //     n_realloc_database++; data_database.sequences = (unsigned char *) realloc(data_database.sequences, READBUF*n_realloc_database*sizeof(unsigned char));
                    //     if(dacountta_database.sequences == NULL) terror("Could not reallocate temporary database");
                    // }


                }else{ //It can be anything (including N, Y, X ...)

                    if(c != '\n' && c != '>'){
                        word_size = 0;
                        // data_database.sequences[pos_in_database++] = (unsigned char) 'N'; //Convert to N
                        ++current_len;
                        // if(pos_in_database == READBUF*n_realloc_database){ 
                        //     n_realloc_database++; data_database.sequences = (unsigned char *) realloc(data_database.sequences, READBUF*n_realloc_database*sizeof(unsigned char));
                        // if(data_database.sequences == NULL) terror("Could not reallocate temporary database");
                        // }
                    } 
                }
                if(word_size == custom_kmer){
                    //write to hash table
                                       
		
                    c_hash = universal_hash_function(0, curr_kmer, char_converter, m_prime);
                    
                    

                    if(st.count[c_hash] == 0){
                        
                        memcpy(st.table[c_hash].kmer, curr_kmer, custom_kmer);
                        st.table[c_hash].hash = hashOfWord(curr_kmer, custom_kmer);
                        st.table[c_hash].pos = current_len;
                        st.table[c_hash].next = NULL;
                        ++used_entries;
                    }else{

                        aux_kmer = getNewLocationllpos_kmer(mp_kmer, &n_pools_used_kmer);    
                        memcpy(aux_kmer->kmer, curr_kmer, custom_kmer);
                        aux_kmer->next = st.table[c_hash].next;
                        aux_kmer->pos = current_len;
                        aux_kmer->hash = hashOfWord(curr_kmer, custom_kmer);
                        st.table[c_hash].next = aux_kmer;
                        
                    }
                    ++st.count[c_hash];
                    
                    
                    


		
		            // memcpy(aux_kmer, &curr_kmer[1], custom_kmer-1);
                    // memcpy(curr_kmer, aux_kmer, custom_kmer-1);

                    // Non overlapping
                    word_size = 0;

                    // Overlapping
                    //memmove(&curr_kmer[0], &curr_kmer[1], custom_kmer-1);
                    //--word_size;
                }
            }
            word_size = 0;
            
        }else{
            c = buffered_fgetc(temp_seq_buffer, &idx, &r, database);    
        }
        
    }

    //end = clock();

    fprintf(stdout, "[INFO] Used entries %"PRIu64" and a size of %"PRIu64", Load Factor = %"PRIu64"%%.\n", used_entries, m_prime, (100*used_entries) / m_prime);
    fprintf(stdout, "[INFO] Starting full rehash\n");

    st.second_level = (Def_pos **) calloc(m_prime, sizeof(Def_pos *));
    if(st.second_level == NULL) terror("Could not allocate second level table");
    for(i=0; i<m_prime; i++){
        st.second_level[i] = (Def_pos *) calloc(st.count[i]*st.count[i], sizeof(Def_pos));
        if(st.second_level[i] == NULL) terror("Could not allocate second level loop");
    }

    /*
typedef struct linked_list_pos{
    uint64_t pos;
    struct linked_list_pos * next;
} llpos;

typedef struct linked_list_kmer{
    unsigned char kmer[32];
    uint64_t hash;
    struct linked_list_kmer * next;
} llpos_kmer;

typedef struct def_pos{
    uint64_t full_hash;
    llpos * next;
} Def_pos;

typedef struct static_table{
    llpos_kmer * table;
    uint64_t * count;
    uint64_t * picked_hash;
    Def_pos ** second_level;

} Static_table;

    */
    
    uint64_t unsolved = 0;
    for(i=0; i<m_prime; i++){
        uint64_t current_picked_hash = 1; 
        uint64_t computed_for_reset = 0;
        unsigned char solved_collisions = FALSE;

        
        while(current_picked_hash <= n_hash_functions && solved_collisions == FALSE){

            solved_collisions = TRUE;
            computed_for_reset = 0;            
            st.picked_hash[i] = current_picked_hash;
            if(st.count[i] > 0){
                
                aux_kmer = &st.table[i];
                while(aux_kmer != NULL){
                    c_hash = universal_hash_function(current_picked_hash, aux_kmer->kmer, char_converter, st.count[i]*st.count[i]);
                    
                    
                    if(st.second_level[i][c_hash].next == NULL){
                        // This hash in second table did not exist yet
                        st.second_level[i][c_hash].full_hash = aux_kmer->hash;
                        aux = getNewLocationllpos(mp, &n_pools_used);
                        aux->pos = aux_kmer->pos;
                        aux->next = NULL;
                        st.second_level[i][c_hash].next = aux;
                        

                    }else{
                        // It existed, check that it is the same and hence no collision
                        // If it is the last hash function, then let it happen with errors
                        if(current_picked_hash < n_hash_functions && st.second_level[i][c_hash].full_hash != aux_kmer->hash){
                            // It already exists, try next hashing function
                            reset_llpos(mp, &n_pools_used, computed_for_reset);
                            solved_collisions = FALSE;
                            computed_for_reset = 0;
                            break;
                        }else{
                            // It is all good, add it!
                            aux = getNewLocationllpos(mp, &n_pools_used);
                            aux->pos = aux_kmer->pos;
                            aux->next = st.second_level[i][c_hash].next;
                            st.second_level[i][c_hash].next = aux;
                        }

                    }
                    
                    ++computed_for_reset;
                    aux_kmer = aux_kmer->next;
                }
                
            }
            if(solved_collisions == FALSE){ /*fprintf(stdout, "Trying %"PRIu64" with hash %"PRIu64"\n", i, current_picked_hash);*/ ++current_picked_hash; }
        }

        if(solved_collisions == FALSE){ /*fprintf(stdout, "[FATAL] Could not solve collisions at %"PRIu64"\n", i); exit(-1);*/ ++unsolved; }   
    }


    fprintf(stdout, "[INFO] Full rehash completed. Unsolved = %"PRIu64", %"PRIu64"%%.\n", unsolved, (100*unsolved)/used_entries);

    exit(-1);

    // data_database.total_len = pos_in_database;

    //fprintf(stdout, "[INFO] Database loaded and of length %"PRIu64". Hash table building took %e seconds\n", data_database.total_len, (double)(end-begin)/CLOCKS_PER_SEC);
    fprintf(stdout, "[INFO] Database loaded and of length %"PRIu64".\n", current_len);
    //close database
    fclose(database);

    
    
    //begin = clock();

    

    

    
    
    
    double pixel_size_db = (double) dimension / (double) current_len;
    double ratio_db = (double) current_len / dimension;


    // Get file length
    fseek(query, 0, SEEK_END);
    uint64_t aprox_len_query = ftell(query);
    rewind(query);

    uint64_t a_hundreth = (aprox_len_query/100);
    double pixel_size_query = (double) dimension / (double) aprox_len_query;
    double ratio_query = (double) aprox_len_query / dimension;
    

    double i_r_fix = MAX(1.0, custom_kmer * pixel_size_query);
    double j_r_fix = MAX(1.0, custom_kmer * pixel_size_db);

    
    
    fprintf(stdout, "[INFO] Ratios: Q [%e] D [%e]. Lenghts: Q [%"PRIu64"] D [%"PRIu64"]\n", ratio_query, ratio_db, aprox_len_query, current_len);
    fprintf(stdout, "[INFO] Pixel size: Q [%e] D [%e].\n", pixel_size_query, pixel_size_db);


    fprintf(stdout, "[INFO] Computing absolute hit numbers.\n");


    current_len = 0;

    llpos * the_original_hit;

    //To force reading from the buffer
    idx = READBUF + 1;
    c = buffered_fgetc(temp_seq_buffer, &idx, &r, query);    
    
    while((!feof(query) || (feof(query) && idx < r))){

        if(c == '>'){
            word_size = 0;
            word_size_rev = custom_kmer-1;
            



            while(c != '\n'){ c = buffered_fgetc(temp_seq_buffer, &idx, &r, query); } //Skip ID
                

            while(c != '>' && (!feof(query) || (feof(query) && idx < r))){ //Until next id
                c = buffered_fgetc(temp_seq_buffer, &idx, &r, query);
                c = toupper(c);
                if(c == 'A' || c == 'C' || c == 'G' || c == 'T'){
                    
                    ++current_len;
                    if(current_len % a_hundreth == 0){ 
                        fprintf(stdout, "%"PRIu64"%%..", 1+100*current_len/aprox_len_query); 
                        //printf("%"PRIu64"%%..wasted: (%e) (%e)", 1+100*pos_in_query/aprox_len_query, (double)(wasted_cycles_forward)/CLOCKS_PER_SEC, (double)(wasted_cycles_reverse)/CLOCKS_PER_SEC); 
                        fflush(stdout);
                    }
                    // if(pos_in_query % 500000 == 0){
                    //     fprintf(stdout, "[INFO] Query aprox length %"PRIu64". I have done: %"PRIu64" and time= %e seconds\n", aprox_len_query, pos_in_query, (double)(clock()-begin)/CLOCKS_PER_SEC);
                    //     begin = clock();
                    // } 
                    curr_kmer[word_size] = (unsigned char) c;
                    ++word_size;

                    switch(c){
                        case ('A'): reverse_kmer[word_size_rev] = (unsigned)'T';
                        break;
                        case ('C'): reverse_kmer[word_size_rev] = (unsigned)'G';
                        break;
                        case ('G'): reverse_kmer[word_size_rev] = (unsigned)'C';
                        break;
                        case ('T'): reverse_kmer[word_size_rev] = (unsigned)'A';
                        break;
                    }
                    if(word_size_rev != 0) --word_size_rev;



                    
                    if(word_size == custom_kmer){


                        /*
                        aux = ct->table[char_converter[curr_kmer[0]]][char_converter[curr_kmer[1]]][char_converter[curr_kmer[2]]]
                        [char_converter[curr_kmer[3]]][char_converter[curr_kmer[4]]][char_converter[curr_kmer[5]]]
                        [char_converter[curr_kmer[6]]][char_converter[curr_kmer[7]]][char_converter[curr_kmer[8]]]
                        [char_converter[curr_kmer[9]]][char_converter[curr_kmer[10]]][char_converter[curr_kmer[11]]];

                        the_original_hit = aux;
                        */


                        //uint64_t hash_forward, hash_reverse;
                        //hash_forward = hashOfWord(&curr_kmer[FIXED_K], custom_kmer - FIXED_K);
                        //hash_reverse = hashOfWord(&reverse_kmer[FIXED_K], custom_kmer - FIXED_K);
                        /*
                        unsigned char hash_forward[MAX_DECOMP_HASH], hash_reverse[MAX_DECOMP_HASH];
                        decomposed_hash_of_word(&curr_kmer[0], &hash_forward[0], custom_kmer);
                        decomposed_hash_of_word(&reverse_kmer[0], &hash_reverse[0], custom_kmer);
                        */
                        

                        /*
                        uint64_t w;
                        for(w=0;w<custom_kmer;w++){
                            printf("%c", (char) curr_kmer[w]);
                        }
                        printf("\n");
                        for(w=0;w<custom_kmer;w++){
                            printf("%c", (char) reverse_kmer[w]);
                        }
                        printf("---------------\n"); getchar();
                        */
                        /*

                        while(aux != NULL){

                            if(xor_decomposed_hash(aux->decomp_hash, hash_forward, custom_kmer) <= max_differences){
                            //if(aux->extended_hash == hash_forward){

                                the_original_hit->hits_count++;
                                
                            }
                            aux = aux->next;
                        }

                        

                        aux = ct->table[char_converter[reverse_kmer[0]]][char_converter[reverse_kmer[1]]][char_converter[reverse_kmer[2]]]
                        [char_converter[reverse_kmer[3]]][char_converter[reverse_kmer[4]]][char_converter[reverse_kmer[5]]]
                        [char_converter[reverse_kmer[6]]][char_converter[reverse_kmer[7]]][char_converter[reverse_kmer[8]]]
                        [char_converter[reverse_kmer[9]]][char_converter[reverse_kmer[10]]][char_converter[reverse_kmer[11]]];

                        the_original_hit = aux;

                        while(aux != NULL){                          
                            

                            if(xor_decomposed_hash(aux->decomp_hash, hash_reverse, custom_kmer) <= max_differences){
                            //if(aux->extended_hash == hash_reverse){

                                the_original_hit->hits_count++;                            
                                
                            }
                            
                            aux = aux->next;
                        }
                        */
                        // Overlapping
                        
                        // memmove(&curr_kmer[0], &curr_kmer[1], custom_kmer-1);
                        // memmove(&reverse_kmer[1], &reverse_kmer[0], custom_kmer-1);
                        // --word_size;

                        // Non overlapping
                        word_size = 0;
                        word_size_rev = custom_kmer-1;
                    }


            
                    // if(pos_in_query == READBUF*n_realloc_database){ 
                    //     n_realloc_database++; data_query.sequences = (unsigned char *) realloc(data_query.sequences, READBUF*n_realloc_database*sizeof(unsigned char));
                    //     if(data_query.sequences == NULL) terror("Could not reallocate temporary query");
                    // }
                }else{
                    if(c != '\n' && c != '>'){
                        word_size = 0;
                        word_size_rev = custom_kmer-1;
                        ++current_len;
                        // data_query.sequences[pos_in_query++] = (unsigned char) 'N'; //Convert to N
                        // if(pos_in_query == READBUF*n_realloc_database){ 
                        //     n_realloc_database++; data_query.sequences = (unsigned char *) realloc(data_query.sequences, READBUF*n_realloc_database*sizeof(unsigned char));
                        //     if(data_query.sequences == NULL) terror("Could not reallocate temporary query");
                        // }
                    }
                }
            }
        }else{
            c = buffered_fgetc(temp_seq_buffer, &idx, &r, query);    
        }
        
    }

    

    /// Out

    fprintf(stdout, "Scanning hits table.\n");

    uint64_t total_hits = 0;
    uint64_t table_size = 0;

    

    
    double average_hit = (double) total_hits / (double) table_size;

    fprintf(stdout, "[INFO] Total hit count is %"PRIu64" on a size of %"PRIu64" Avg = %e.\n", total_hits, table_size, average_hit);

    fprintf(stdout, "[INFO] Generating hits.\n");



    current_len = 0;

    //To force reading from the buffer
    idx = READBUF + 1;
    c = buffered_fgetc(temp_seq_buffer, &idx, &r, query);    
    fseek(query, 0, SEEK_SET);
    
    while((!feof(query) || (feof(query) && idx < r))){

        if(c == '>'){
            word_size = 0;
            word_size_rev = custom_kmer-1;
            



            while(c != '\n'){ c = buffered_fgetc(temp_seq_buffer, &idx, &r, query); } //Skip ID
                

            while(c != '>' && (!feof(query) || (feof(query) && idx < r))){ //Until next id
                c = buffered_fgetc(temp_seq_buffer, &idx, &r, query);
                c = toupper(c);
                if(c == 'A' || c == 'C' || c == 'G' || c == 'T'){
                    
                    ++current_len;
                    if(current_len % a_hundreth == 0){ 
                        fprintf(stdout, "%"PRIu64"%%..", 1+100*current_len/aprox_len_query); 
                        //printf("%"PRIu64"%%..wasted: (%e) (%e)", 1+100*pos_in_query/aprox_len_query, (double)(wasted_cycles_forward)/CLOCKS_PER_SEC, (double)(wasted_cycles_reverse)/CLOCKS_PER_SEC); 
                        fflush(stdout);
                    }
                    // if(pos_in_query % 500000 == 0){
                    //     fprintf(stdout, "[INFO] Query aprox length %"PRIu64". I have done: %"PRIu64" and time= %e seconds\n", aprox_len_query, pos_in_query, (double)(clock()-begin)/CLOCKS_PER_SEC);
                    //     begin = clock();
                    // } 
                    curr_kmer[word_size] = (unsigned char) c;
                    ++word_size;

                    switch(c){
                        case ('A'): reverse_kmer[word_size_rev] = (unsigned)'T';
                        break;
                        case ('C'): reverse_kmer[word_size_rev] = (unsigned)'G';
                        break;
                        case ('G'): reverse_kmer[word_size_rev] = (unsigned)'C';
                        break;
                        case ('T'): reverse_kmer[word_size_rev] = (unsigned)'A';
                        break;
                    }
                    if(word_size_rev != 0) --word_size_rev;

                    
                    if(word_size == custom_kmer){


                        
                        /*
                        aux = ct->table[char_converter[curr_kmer[0]]][char_converter[curr_kmer[1]]][char_converter[curr_kmer[2]]]
                        [char_converter[curr_kmer[3]]][char_converter[curr_kmer[4]]][char_converter[curr_kmer[5]]]
                        [char_converter[curr_kmer[6]]][char_converter[curr_kmer[7]]][char_converter[curr_kmer[8]]]
                        [char_converter[curr_kmer[9]]][char_converter[curr_kmer[10]]][char_converter[curr_kmer[11]]];

                        the_original_hit = aux;



                        //uint64_t hash_forward, hash_reverse;
                        //hash_forward = hashOfWord(&curr_kmer[FIXED_K], custom_kmer - FIXED_K);
                        //hash_reverse = hashOfWord(&reverse_kmer[FIXED_K], custom_kmer - FIXED_K);
                        unsigned char hash_forward[MAX_DECOMP_HASH], hash_reverse[MAX_DECOMP_HASH];
                        decomposed_hash_of_word(&curr_kmer[0], &hash_forward[0], custom_kmer);
                        decomposed_hash_of_word(&reverse_kmer[0], &hash_reverse[0], custom_kmer);

                        */

                        /*
                        uint64_t w;
                        for(w=0;w<custom_kmer;w++){
                            printf("%c", (char) curr_kmer[w]);
                        }
                        printf("\n");
                        for(w=0;w<custom_kmer;w++){
                            printf("%c", (char) reverse_kmer[w]);
                        }
                        printf("---------------\n"); getchar();
                        */
                        
                        /*
                        while(aux != NULL && the_original_hit->hits_count < (uint64_t)average_hit){


                            if(xor_decomposed_hash(aux->decomp_hash, hash_forward, custom_kmer) <= max_differences){
                            //if(aux->extended_hash == hash_forward){


                                // begin = clock();

                                // Convert scale to representation
                                uint64_t redir_db = (uint64_t) (aux->pos / (ratio_db));
                                uint64_t redir_query = (uint64_t) (current_len / (ratio_query));

                                //representation[redir_query][redir_db] = 1;

                                // long double i_r = MAX(1.0, custom_kmer * pixel_size_query);
                                // long double j_r = MAX(1.0, custom_kmer * pixel_size_db);

                                // Simple pixel paint
                                //representation[redir_query][redir_db] = 1;

                                double i_r = i_r_fix; double j_r = j_r_fix;

                                // printf("Hit is at %"PRIu64", %"PRIu64"\n", current_len, aux->pos);
                                // printf("redir : %"PRIu64" %"PRIu64"\n", redir_query, redir_db);
                                // printf("drwaing: %"PRId64", %"PRId64"\n", (int64_t) redir_query - (int64_t) i_r, (int64_t) redir_db - (int64_t) j_r);
                                // getchar();

                                while((uint64_t) i_r >= 1 && (uint64_t) j_r >= 1){
                                    
                                    
                                     if((int64_t) redir_query - (int64_t) i_r > 0 && (int64_t) redir_db - (int64_t) j_r > 0){
                                         representation[(int64_t) redir_query - (int64_t) i_r][(int64_t) redir_db - (int64_t) j_r]++;
                                         //printf("\tplus at %"PRId64", %"PRId64"\n", (int64_t) redir_query - (int64_t) i_r, (int64_t) redir_db - (int64_t) j_r);
                                    }else{
                                        representation[redir_query][redir_db]++;
                                        break;
                                    }
                                    
                                    i_r -= MIN(1.0, pixel_size_query);
                                    j_r -= MIN(1.0, pixel_size_db);

                                }
                                
                            }
                            aux = aux->next;
                        }




                        aux = ct->table[char_converter[reverse_kmer[0]]][char_converter[reverse_kmer[1]]][char_converter[reverse_kmer[2]]]
                        [char_converter[reverse_kmer[3]]][char_converter[reverse_kmer[4]]][char_converter[reverse_kmer[5]]]
                        [char_converter[reverse_kmer[6]]][char_converter[reverse_kmer[7]]][char_converter[reverse_kmer[8]]]
                        [char_converter[reverse_kmer[9]]][char_converter[reverse_kmer[10]]][char_converter[reverse_kmer[11]]];


                        the_original_hit = aux;

                        while(aux != NULL && the_original_hit->hits_count < (uint64_t)average_hit){                          
                            

                            if(xor_decomposed_hash(aux->decomp_hash, hash_reverse, custom_kmer) <= max_differences){
                            //if(aux->extended_hash == hash_reverse){
                                // printf("enter\n");
                                // // begin = clock();
                                
                                // uint64_t w;
                                // for(w=0;w<custom_kmer;w++){
                                //     printf("%c", (char) curr_kmer[w]);
                                // }
                                // printf("\n");
                                // for(w=0;w<custom_kmer;w++){
                                //     printf("%c", (char) reverse_kmer[w]);
                                // }
                                // printf("\n---------------\n"); getchar();
				//
                                

                                // Convert scale to representation
                                uint64_t redir_db = (uint64_t) ( (aux->pos) / (ratio_db));
                                uint64_t redir_query = (uint64_t) ((current_len ) / (ratio_query));
                                
                                
                                // printf("found at %"PRIu64", %"PRIu64"\n", current_len, aux->pos);
                                // printf("original paint is %"PRIu64", %"PRIu64"\n", redir_query, (uint64_t)(aux->pos / ratio_db));
                                // printf("therefore i paint at %"PRIu64", %"PRIu64"\n", redir_query, redir_db);
                                // getchar();
                                

                                //representation[redir_query][redir_db] = 1;

                                // long double i_r = MAX(1.0, custom_kmer * pixel_size_query);
                                // long double j_r = MAX(1.0, custom_kmer * pixel_size_db);
                                

                                // Simple pixel paint
                                //representation[redir_query][redir_db] = 1;

                                double i_r = i_r_fix; double j_r = j_r_fix;

                                while((uint64_t) i_r >= 1 && (uint64_t) j_r >= 1){
                                    // printf("I have %Le %Le which is %"PRIu64" %"PRIu64"\n", i_r, j_r, (uint64_t) i_r, (uint64_t) j_r);
                                    // printf("Hit is at %"PRIu64", %"PRIu64"\n", pos_in_query, aux->pos);
                                    // printf("redir : %"PRIu64" %"PRIu64"\n", redir_query, redir_db);
                                    // printf("drwaing: %"PRId64", %"PRId64"\n", (int64_t) redir_query - (int64_t) i_r, (int64_t) redir_db - (int64_t) j_r);
                                    // getchar();
                                    if((int64_t) redir_query - (int64_t) i_r > 0 && (int64_t) redir_db + (int64_t) j_r < dimension){
                                         representation[(int64_t) redir_query - (int64_t) i_r][(int64_t) redir_db + (int64_t) j_r]++;
                                         //printf("\tplus at %"PRId64", %"PRId64"\n", (int64_t) redir_query - (int64_t) i_r, (int64_t) redir_db + (int64_t) j_r);
                                    }else{
                                        //printf("%"PRIu64",%"PRIu64"\n", redir_query, redir_db);
                                        representation[redir_query][redir_db]++;
                                        break;
                                    }
                                    i_r -= MIN(1.0, pixel_size_query);
                                    j_r -= MIN(1.0, pixel_size_db);

                                }
                                
                                
                            }
                            
                            aux = aux->next;
                        }
                        */
                        // Overlapping
                        
                        // memmove(&curr_kmer[0], &curr_kmer[1], custom_kmer-1);
                        // memmove(&reverse_kmer[1], &reverse_kmer[0], custom_kmer-1);
                        // --word_size;

                        // Non overlapping
                        word_size = 0;
                        word_size_rev = custom_kmer-1;
                    }


            
                    // if(pos_in_query == READBUF*n_realloc_database){ 
                    //     n_realloc_database++; data_query.sequences = (unsigned char *) realloc(data_query.sequences, READBUF*n_realloc_database*sizeof(unsigned char));
                    //     if(data_query.sequences == NULL) terror("Could not reallocate temporary query");
                    // }
                }else{
                    if(c != '\n' && c != '>'){
                        word_size = 0;
                        word_size_rev = custom_kmer-1;
                        ++current_len;
                        // data_query.sequences[pos_in_query++] = (unsigned char) 'N'; //Convert to N
                        // if(pos_in_query == READBUF*n_realloc_database){ 
                        //     n_realloc_database++; data_query.sequences = (unsigned char *) realloc(data_query.sequences, READBUF*n_realloc_database*sizeof(unsigned char));
                        //     if(data_query.sequences == NULL) terror("Could not reallocate temporary query");
                        // }
                    }
                }
            }
        }else{
            c = buffered_fgetc(temp_seq_buffer, &idx, &r, query);    
        }
        
    }

    //end = clock();

    
    

    //fprintf(stdout, "\n[INFO] Query length %"PRIu64". Hits completed. Took %e seconds\n", data_query.total_len, (double)(end-begin)/CLOCKS_PER_SEC);
    fprintf(stdout, "\n[INFO] Query length %"PRIu64".\n", current_len);

    //begin = clock();


    /*
    Queue * traverse = queue_head.head;
    while(traverse != NULL){
        printf("current_piece: %"PRIu64"-%"PRIu64"\n", traverse->r1, traverse->r2);
        traverse = traverse->next;
    }
    */


    //reads_per_thread = (uint64_t) (floorl((long double) data_query.n_seqs / (long double) n_threads));
    
    fprintf(stdout, "[INFO] Writing matrix\n");

    // representation[0][0] = 1;
    // representation[1][0] = 1;
    // representation[2][0] = 1;
    // representation[3][0] = 1;
    // representation[4][0] = 1;
    // representation[5][0] = 1;


    // for(i=0; i<dimension+1; i++){
    //     for(j=0; j<dimension+1; j++){
    //         fprintf(out_database, "%d ", (int) representation[i][j]);
    //     }
    //     fprintf(out_database, "\n");
    // }

    // Simple filtering
    // Print score

    // And replace 2's with 1's 
    for(i=0; i<dimension+1; i++){
        for(j=0; j<dimension; j++){
            fprintf(out_database, "%"PRIu64" ", representation[i][j]);
        }
        fprintf(out_database, "%"PRIu64"\n",  representation[i][dimension]);
    }

    

    /*
    uint64_t z;
    for(z=0; z<POOL_SIZE; z++){
        aux = mp[0].base + z;
        fprintf(stdout, "%p\n", aux);
        fflush(stdout);
    }
    */
    

    //free(ct->table);

    for(i=0;i<=n_pools_used;i++){
        free(mp[i].base);
    }
    for(i=0;i<dimension;i++){
        free(representation[i]);
    }
    free(representation);
    if(out_database != NULL) fclose(out_database);
    
    return 0;
}

void init_args(int argc, char ** av, FILE ** query, FILE ** database, FILE ** out_database, uint64_t * custom_kmer, uint64_t * dimension, uint64_t * max_differences){

    int pNum = 0;
    while(pNum < argc){
        if(strcmp(av[pNum], "--help") == 0){
            fprintf(stdout, "USAGE:\n");
            fprintf(stdout, "           CHROMEISTER -query [query] -db [database] -out [outfile]\n");
            fprintf(stdout, "OPTIONAL:\n");
            fprintf(stdout, "           -kmer       [Integer:   k>1 (default 12)]\n");
            fprintf(stdout, "           -dimension  Size of the output [Integer:   d>0 (default 1000)]\n");
            fprintf(stdout, "           -diffs      Maximum number of different 4-mers in a hit (default 0)\n");
            fprintf(stdout, "           -out        [File path]\n");
            fprintf(stdout, "           --help      Shows help for program usage\n");
            fprintf(stdout, "\n");
            fprintf(stdout, "PLEASE NOTICE: The reverse complementary is calculated for the QUERY.\n");
            exit(1);
        }
        if(strcmp(av[pNum], "-query") == 0){
            *query = fopen64(av[pNum+1], "rt");
            if(query==NULL) terror("Could not open query file");
        }
        if(strcmp(av[pNum], "-db") == 0){
            *database = fopen64(av[pNum+1], "rt");
            if(database==NULL) terror("Could not open database file");
        }
        if(strcmp(av[pNum], "-out") == 0){
            *out_database = fopen(av[pNum+1], "wt");
            if(out_database==NULL) terror("Could not open output database file");
        }
        if(strcmp(av[pNum], "-kmer") == 0){
            *custom_kmer = (uint64_t) atoi(av[pNum+1]);
            if(*custom_kmer < BYTES_IN_MER) terror("K-mer size must be larger than 4");
            if(*custom_kmer % BYTES_IN_MER != 0) terror("K-mer size must be a multiple of 4");

        }
        if(strcmp(av[pNum], "-dimension") == 0){
            *dimension = (uint64_t) atoi(av[pNum+1]);
            if(*dimension < 1) terror("Dimension must be a positive integer");
        }
        if(strcmp(av[pNum], "-diffs") == 0){
            *max_differences = (uint64_t) atoi(av[pNum+1]);
        }
        pNum++;
    }
    
    if(*query==NULL || *database==NULL || *out_database==NULL) terror("A query, database and output file is required");
}

